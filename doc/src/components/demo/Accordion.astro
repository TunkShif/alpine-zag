---
import DemoCard from "@/components/DemoCard.astro"
import { checkbox } from "@/styles"

const items = [
  {
    name: "Apple",
    description:
      "Apples are crisp, juicy fruits with a sweet or tart flavor. They come in various colors such as red, green, and yellow."
  },
  {
    name: "Banana",
    description:
      "Bananas are elongated, curved fruits with a creamy flesh inside. They are rich in potassium and are commonly eaten as a healthy snack."
  },
  {
    name: "Orange",
    description:
      "Oranges are round citrus fruits with a bright orange skin and juicy flesh. They are known for their high vitamin C content and refreshing taste."
  }
]
---

<script>
  import { normalizeProps, useAPI, useMachine } from "@tunkshif/alpine-zag"
  import { id } from "@/utils"
  import * as accordion from "@zag-js/accordion"
  import Alpine from "alpinejs"

  document.addEventListener("alpine:init", () => {
    Alpine.data("Accordion", (controls) => {
      const service = useMachine(
        Alpine,
        accordion.machine({
          id: id(),
          value: ["Apple"]
        }),
        {
          context: controls
        }
      )
      const api = useAPI(Alpine, () =>
        accordion.connect(service.state.value, service.send, normalizeProps)
      )
      return {
        init() {
          service.start()
          api.start()
        },
        destroy() {
          api.stop()
          service.stop()
        },
        get api() {
          return api.value
        }
      }
    })
  })
</script>

<DemoCard
  name="accordion"
  file="Accordion"
  title="Accordion"
  controls={{ collapsible: true, multiple: false }}
>
  <div slot="content" x-data="Accordion(controls)" x-props="api.rootProps">
    <ul>
      {
        items.map(({ name, description }) => (
          <li x-props={`api.getItemProps({ value: '${name}' })`}>
            <div>
              <button x-props={`api.getItemTriggerProps({ value: '${name}' })`}>
                <h3>{name}</h3>
              </button>
              <div x-cloak x-props={`api.getItemContentProps({ value: '${name}' })`}>
                <div class="overflow-hidden">
                  <p class="text-sm py-2 px-4 leading-relaxed">{description}</p>
                </div>
              </div>
            </div>
          </li>
        ))
      }
    </ul>
  </div>

  <div slot="control" class="w-full flex flex-col gap-2">
    <label class="flex justify-between items-center text-sm">
      <span>Collapsible</span>
      <input type="checkbox" x-model="controls.collapsible" class={checkbox()} />
    </label>
    <label class="flex justify-between items-center text-sm">
      <span>Multiple</span>
      <input type="checkbox" x-model="controls.multiple" class={checkbox()} />
    </label>
  </div>
</DemoCard>

<style>
  [data-part="root"] {
    @apply w-72 md:w-96 bg-white rounded-md shadow-sm;
  }

  [data-part="item"][data-state="open"] + [data-part="item"] [data-part="item-trigger"] {
    @apply border-t;
  }

  [data-part="item-trigger"] {
    @apply flex items-center border-b border-slate-200/60 justify-between w-full p-4 font-medium text-slate-700 text-left;
  }

  [data-part="item-content"] {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 250ms ease-in-out;
  }

  [data-part="item-content"][data-state="open"] {
    grid-template-rows: 1fr;
  }
</style>
